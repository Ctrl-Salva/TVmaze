<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/layout}">

<head>
  <title>Lista de Séries</title>
  
</head>

<body>

  <section layout:fragment="conteudo">
    <div class="container my-5">
      <div class="text-center mb-5">
        <h2 class="display-5 fw-bold">Séries</h2>
        <p class="text-muted">Explore nossa coleção completa</p>
      </div>

      <!-- Filtros -->
      <div class="filter-card shadow-sm bg-dark-subtle rounded p-3 mb-5">
        <form method="get" th:action="@{/series}" id="filterForm">
          <div class="row g-3">
            <div class="col-md-3">
              <label for="generoId" class="form-label fw-bold">Gênero</label>
              <select class="form-select" id="generoId" name="generoId" onchange="document.getElementById('filterForm').submit()">
                <option value="">Todos os gêneros</option>
                <option th:each="gen : ${generosDisponiveis}" 
                        th:value="${gen.generoId}" 
                        th:text="${gen.nome}"
                        th:selected="${gen.generoId == generoIdSelecionado}">
                </option>
              </select>
            </div>

            <div class="col-md-2">
              <label for="linguagem" class="form-label fw-bold">Idioma</label>
              <select class="form-select" id="linguagem" name="linguagem" onchange="document.getElementById('filterForm').submit()">
                <option value="">Todos os idiomas</option>
                <option th:each="ling : ${linguagensDisponiveis}" 
                        th:value="${ling}" 
                        th:text="${ling}"
                        th:selected="${ling == linguagemSelecionada}">
                </option>
              </select>
            </div>

            <div class="col-md-2">
              <label for="notaMinima" class="form-label fw-bold">Nota Mínima</label>
              <select class="form-select" id="notaMinima" name="notaMinima" onchange="document.getElementById('filterForm').submit()">
                <option value="">Qualquer nota</option>
                <option value="7.0" th:selected="${notaMinimaSelecionada == 7.0}">7.0+</option>
                <option value="8.0" th:selected="${notaMinimaSelecionada == 8.0}">8.0+</option>
                <option value="9.0" th:selected="${notaMinimaSelecionada == 9.0}">9.0+</option>
              </select>
            </div>

            <div class="col-md-2">
              <label for="ano" class="form-label fw-bold">Ano</label>
              <select class="form-select" id="ano" name="ano" onchange="document.getElementById('filterForm').submit()">
                <option value="">Todos os anos</option>
                <option th:each="anoDisp : ${anosDisponiveis}" 
                        th:value="${anoDisp}" 
                        th:text="${anoDisp}"
                        th:selected="${anoDisp == anoSelecionado}">
                </option>
              </select>
            </div>

            <div class="col-md-3">
              <label for="ordenar" class="form-label fw-bold">Ordenar por</label>
              <div class="input-group">
                <select class="form-select" id="ordenar" name="ordenar" onchange="document.getElementById('filterForm').submit()">
                  <option value="dataEstreia" th:selected="${ordenarSelecionado == 'dataEstreia'}">Data de Estreia</option>
                  <option value="nome" th:selected="${ordenarSelecionado == 'nome'}">Nome</option>
                  <option value="nota" th:selected="${ordenarSelecionado == 'nota'}">Nota</option>
                </select>
                <select class="form-select" id="direcao" name="direcao" onchange="document.getElementById('filterForm').submit()" style="max-width: 100px;">
                  <option value="desc" th:selected="${direcaoSelecionada == 'desc'}">↓</option>
                  <option value="asc" th:selected="${direcaoSelecionada == 'asc'}">↑</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col-12">
              <a th:href="@{/series}" class="btn btn-outline-secondary">
                Limpar Filtros
              </a>
              <span class="text-muted ms-3">
                <strong th:text="${seriesPage.totalElements}">0</strong> série(s) encontrada(s)
              </span>
            </div>
          </div>
        </form>
      </div>

      <!-- Grid de Séries -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-5 g-4 mb-5">
        <div class="col" th:each="serie : ${seriesPage.content}">
          <div class="card h-100 shadow-sm hover-card">
            <div class="position-relative">
              <img th:src="${serie.imagem != null ? serie.imagem.medio : 'https://via.placeholder.com/210x295?text=Sem+Imagem'}" 
                   class="card-img-top" 
                   th:alt="${serie.nome}"
                   style="height: 295px; object-fit: cover;">
              <span class="position-absolute top-0 end-0 badge bg-success m-2" 
                    th:if="${serie.dataEstreia != null && #temporals.year(serie.dataEstreia) >= (#temporals.year(#temporals.createNow()) - 1)}">
                NOVO
              </span>
            </div>
            
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-truncate" th:text="${serie.nome}">Nome da Série</h5>
              
              <div class="mb-2">
                <span class="badge bg-warning text-dark" th:if="${serie.nota != null}">
                  ⭐ <span th:text="${#numbers.formatDecimal(serie.nota, 1, 1)}">0.0</span>
                </span>
                <span class="badge bg-secondary" th:unless="${serie.nota != null}">
                  Sem nota
                </span>
              </div>
              
              <div class="mb-2" th:if="${serie.generos != null && !serie.generos.isEmpty()}">
                <small class="text-muted">
                  <span th:each="genero, iterStat : ${serie.generos}">
                    <span th:text="${genero}">Gênero</span><span th:if="${!iterStat.last}">, </span>
                  </span>
                </small>
              </div>
              
              <small class="text-muted mb-3" th:if="${serie.dataEstreia != null}">
                <i>Estreia: </i><span th:text="${#temporals.format(serie.dataEstreia, 'dd/MM/yyyy')}">01/01/2020</span>
              </small>
              
              <a th:href="@{/series/{id}(id=${serie.serieId})}" class="btn btn-primary mt-auto">
                Ver Detalhes
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensagem quando não há resultados -->
      <div class="text-center mt-5" th:if="${seriesPage.content == null || seriesPage.content.isEmpty()}">
        <p class="lead text-muted">Nenhuma série encontrada com os filtros aplicados.</p>
        <a th:href="@{/series}" class="btn btn-primary">Ver todas as séries</a>
      </div>

      <!-- Paginação -->
      <nav th:if="${seriesPage.totalPages > 1}" aria-label="Navegação de páginas">
        <ul class="pagination justify-content-center">
          
          <!-- Primeira página -->
          <li class="page-item" th:classappend="${seriesPage.first} ? 'disabled'">
            <a class="page-link" 
               th:href="@{/series(page=0, size=${seriesPage.size}, generoId=${generoIdSelecionado}, linguagem=${linguagemSelecionada}, notaMinima=${notaMinimaSelecionada}, ano=${anoSelecionado}, ordenar=${ordenarSelecionado}, direcao=${direcaoSelecionada})}">
              &laquo; Primeira
            </a>
          </li>

          <!-- Página anterior -->
          <li class="page-item" th:classappend="${!seriesPage.hasPrevious()} ? 'disabled'">
            <a class="page-link" 
               th:href="@{/series(page=${seriesPage.number - 1}, size=${seriesPage.size}, generoId=${generoIdSelecionado}, linguagem=${linguagemSelecionada}, notaMinima=${notaMinimaSelecionada}, ano=${anoSelecionado}, ordenar=${ordenarSelecionado}, direcao=${direcaoSelecionada})}">
              Anterior
            </a>
          </li>

          <!-- Números de página -->
          <li class="page-item" 
              th:each="i : ${#numbers.sequence(0, seriesPage.totalPages - 1)}"
              th:if="${i >= seriesPage.number - 2 && i <= seriesPage.number + 2}"
              th:classappend="${i == seriesPage.number} ? 'active'">
            <a class="page-link" 
               th:href="@{/series(page=${i}, size=${seriesPage.size}, generoId=${generoIdSelecionado}, linguagem=${linguagemSelecionada}, notaMinima=${notaMinimaSelecionada}, ano=${anoSelecionado}, ordenar=${ordenarSelecionado}, direcao=${direcaoSelecionada})}"
               th:text="${i + 1}">1</a>
          </li>

          <!-- Próxima página -->
          <li class="page-item" th:classappend="${!seriesPage.hasNext()} ? 'disabled'">
            <a class="page-link" 
               th:href="@{/series(page=${seriesPage.number + 1}, size=${seriesPage.size}, generoId=${generoIdSelecionado}, linguagem=${linguagemSelecionada}, notaMinima=${notaMinimaSelecionada}, ano=${anoSelecionado}, ordenar=${ordenarSelecionado}, direcao=${direcaoSelecionada})}">
              Próxima
            </a>
          </li>

          <!-- Última página -->
          <li class="page-item" th:classappend="${seriesPage.last} ? 'disabled'">
            <a class="page-link" 
               th:href="@{/series(page=${seriesPage.totalPages - 1}, size=${seriesPage.size}, generoId=${generoIdSelecionado}, linguagem=${linguagemSelecionada}, notaMinima=${notaMinimaSelecionada}, ano=${anoSelecionado}, ordenar=${ordenarSelecionado}, direcao=${direcaoSelecionada})}">
              Última &raquo;
            </a>
          </li>
        </ul>

        <!-- Informações da paginação -->
        <div class="text-center text-muted">
          Página <strong th:text="${seriesPage.number + 1}">1</strong> de 
          <strong th:text="${seriesPage.totalPages}">1</strong>
          (mostrando <strong th:text="${seriesPage.numberOfElements}">0</strong> de 
          <strong th:text="${seriesPage.totalElements}">0</strong> séries)
        </div>
      </nav>
    </div>
  </section>

</body>

</html>